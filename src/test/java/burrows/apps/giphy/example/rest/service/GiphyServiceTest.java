package burrows.apps.giphy.example.rest.service;

import burrows.apps.giphy.example.rest.model.GiphyResponse;
import okhttp3.mockwebserver.MockResponse;
import org.junit.After;
import org.junit.Test;
import test.ServiceTestBase;

import java.lang.reflect.Field;
import java.net.HttpURLConnection;

import static org.assertj.core.api.Assertions.assertThat;

/**
 * @author <a href="mailto:jaredsburrows@gmail.com">Jared Burrows</a>
 */
public final class GiphyServiceTest extends ServiceTestBase {
  @After @Override public void tearDown() throws Exception {
    super.tearDown();

    // Destroy singletons
    final Field field = GiphyService.class.getDeclaredField("instance");
    field.setAccessible(true);
    field.set(null, null);
  }

  // --------------------------------------------
  // getTrendingResults
  // --------------------------------------------

  @Test public void testGetTrendingDataFromApiShouldParseCorrectly() {
    // Response
    final String mockResponse = "{\"data\":[{\"type\":\"gif\",\"id\":\"l3UcoeKGT777ML2ta\",\"slug\":\"hallmarkecards-dad-father-fathers-day-l3UcoeKGT777ML2ta\",\"url\":\"http:\\/\\/giphy.com\\/gifs\\/hallmarkecards-dad-father-fathers-day-l3UcoeKGT777ML2ta\",\"bitly_gif_url\":\"http:\\/\\/gph.is\\/1sTtL89\",\"bitly_url\":\"http:\\/\\/gph.is\\/1sTtL89\",\"embed_url\":\"http:\\/\\/giphy.com\\/embed\\/l3UcoeKGT777ML2ta\",\"username\":\"hallmarkecards\",\"source\":\"https:\\/\\/www.hallmarkecards.com\\/\",\"rating\":\"g\",\"content_url\":\"https:\\/\\/www.hallmarkecards.com\\/ecards\\/fathers-day-breakfast-npz5307\",\"user\":{\"avatar_url\":\"https:\\/\\/media4.giphy.com\\/avatars\\/hallmarkecards\\/W8ln0QjAtfUQ.gif\",\"banner_url\":\"https:\\/\\/media4.giphy.com\\/headers\\/hallmarkecards\\/9v2ae0uZWnAb.gif\",\"profile_url\":\"https:\\/\\/giphy.com\\/hallmarkecards\\/\",\"username\":\"hallmarkecards\",\"display_name\":\"Hallmark eCards\",\"twitter\":\"@hallmarkecards\"},\"source_tld\":\"www.hallmarkecards.com\",\"source_post_url\":\"https:\\/\\/www.hallmarkecards.com\\/\",\"is_indexable\":0,\"import_datetime\":\"2016-06-03 19:57:00\",\"trending_datetime\":\"2016-06-18 21:15:03\",\"images\":{\"fixed_height\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"377771\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.mp4\",\"mp4_size\":\"21433\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.webp\",\"webp_size\":\"809928\"},\"fixed_height_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_s.gif\",\"width\":\"356\",\"height\":\"200\"},\"fixed_height_downsampled\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_d.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"127278\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_d.webp\",\"webp_size\":\"126718\"},\"fixed_width\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.gif\",\"width\":\"200\",\"height\":\"113\",\"size\":\"119064\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.mp4\",\"mp4_size\":\"9841\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.webp\",\"webp_size\":\"337074\"},\"fixed_width_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_s.gif\",\"width\":\"200\",\"height\":\"113\"},\"fixed_width_downsampled\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_d.gif\",\"width\":\"200\",\"height\":\"113\",\"size\":\"40521\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_d.webp\",\"webp_size\":\"51568\"},\"fixed_height_small\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.gif\",\"width\":\"178\",\"height\":\"100\",\"size\":\"104302\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.mp4\",\"mp4_size\":\"8500\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.webp\",\"webp_size\":\"291444\"},\"fixed_height_small_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100_s.gif\",\"width\":\"178\",\"height\":\"100\"},\"fixed_width_small\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.gif\",\"width\":\"100\",\"height\":\"56\",\"size\":\"34404\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.mp4\",\"mp4_size\":\"4728\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.webp\",\"webp_size\":\"115922\"},\"fixed_width_small_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w_s.gif\",\"width\":\"100\",\"height\":\"56\"},\"downsized\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"downsized_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy_s.gif\",\"width\":\"640\",\"height\":\"360\"},\"downsized_large\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"downsized_medium\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"original\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\",\"frames\":\"72\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.mp4\",\"mp4_size\":\"37888\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.webp\",\"webp_size\":\"2100910\"},\"original_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy_s.gif\",\"width\":\"640\",\"height\":\"360\"},\"looping\":{\"mp4\":\"http:\\/\\/media.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy-loop.mp4\"}}}]}";

    server.enqueue(new MockResponse()
      .setResponseCode(HttpURLConnection.HTTP_OK)
      .setBody(mockResponse));

    // Request
    final GiphyResponse response = GiphyService.getInstance(mockEndPoint)
                                               .getTrendingResults()
                                               .blockingFirst();

    assertThat(response.getData().get(0).getImages().getFixedHeight().getUrl())
      .isEqualTo("http://media3.giphy.com/media/l3UcoeKGT777ML2ta/200.gif");
  }

  @Test public void testGetTrendingDataWithCustomApiKeyFromApiShouldParseCorrectly() {
    // Response
    final String mockResponse = "{\"data\":[{\"type\":\"gif\",\"id\":\"l3UcoeKGT777ML2ta\",\"slug\":\"hallmarkecards-dad-father-fathers-day-l3UcoeKGT777ML2ta\",\"url\":\"http:\\/\\/giphy.com\\/gifs\\/hallmarkecards-dad-father-fathers-day-l3UcoeKGT777ML2ta\",\"bitly_gif_url\":\"http:\\/\\/gph.is\\/1sTtL89\",\"bitly_url\":\"http:\\/\\/gph.is\\/1sTtL89\",\"embed_url\":\"http:\\/\\/giphy.com\\/embed\\/l3UcoeKGT777ML2ta\",\"username\":\"hallmarkecards\",\"source\":\"https:\\/\\/www.hallmarkecards.com\\/\",\"rating\":\"g\",\"content_url\":\"https:\\/\\/www.hallmarkecards.com\\/ecards\\/fathers-day-breakfast-npz5307\",\"user\":{\"avatar_url\":\"https:\\/\\/media4.giphy.com\\/avatars\\/hallmarkecards\\/W8ln0QjAtfUQ.gif\",\"banner_url\":\"https:\\/\\/media4.giphy.com\\/headers\\/hallmarkecards\\/9v2ae0uZWnAb.gif\",\"profile_url\":\"https:\\/\\/giphy.com\\/hallmarkecards\\/\",\"username\":\"hallmarkecards\",\"display_name\":\"Hallmark eCards\",\"twitter\":\"@hallmarkecards\"},\"source_tld\":\"www.hallmarkecards.com\",\"source_post_url\":\"https:\\/\\/www.hallmarkecards.com\\/\",\"is_indexable\":0,\"import_datetime\":\"2016-06-03 19:57:00\",\"trending_datetime\":\"2016-06-18 21:15:03\",\"images\":{\"fixed_height\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"377771\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.mp4\",\"mp4_size\":\"21433\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.webp\",\"webp_size\":\"809928\"},\"fixed_height_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_s.gif\",\"width\":\"356\",\"height\":\"200\"},\"fixed_height_downsampled\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_d.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"127278\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_d.webp\",\"webp_size\":\"126718\"},\"fixed_width\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.gif\",\"width\":\"200\",\"height\":\"113\",\"size\":\"119064\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.mp4\",\"mp4_size\":\"9841\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.webp\",\"webp_size\":\"337074\"},\"fixed_width_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_s.gif\",\"width\":\"200\",\"height\":\"113\"},\"fixed_width_downsampled\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_d.gif\",\"width\":\"200\",\"height\":\"113\",\"size\":\"40521\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_d.webp\",\"webp_size\":\"51568\"},\"fixed_height_small\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.gif\",\"width\":\"178\",\"height\":\"100\",\"size\":\"104302\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.mp4\",\"mp4_size\":\"8500\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.webp\",\"webp_size\":\"291444\"},\"fixed_height_small_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100_s.gif\",\"width\":\"178\",\"height\":\"100\"},\"fixed_width_small\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.gif\",\"width\":\"100\",\"height\":\"56\",\"size\":\"34404\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.mp4\",\"mp4_size\":\"4728\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.webp\",\"webp_size\":\"115922\"},\"fixed_width_small_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w_s.gif\",\"width\":\"100\",\"height\":\"56\"},\"downsized\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"downsized_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy_s.gif\",\"width\":\"640\",\"height\":\"360\"},\"downsized_large\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"downsized_medium\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"original\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\",\"frames\":\"72\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.mp4\",\"mp4_size\":\"37888\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.webp\",\"webp_size\":\"2100910\"},\"original_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy_s.gif\",\"width\":\"640\",\"height\":\"360\"},\"looping\":{\"mp4\":\"http:\\/\\/media.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy-loop.mp4\"}}}]}";

    server.enqueue(new MockResponse()
      .setResponseCode(HttpURLConnection.HTTP_OK)
      .setBody(mockResponse));

    // Request
    final GiphyResponse response = GiphyService.getInstance(mockEndPoint)
                                               .getTrendingResults(GiphyService.PUBLIC_API_KEY)
                                               .blockingFirst();

    assertThat(response.getData().get(0).getImages().getFixedHeight().getUrl())
      .isEqualTo("http://media3.giphy.com/media/l3UcoeKGT777ML2ta/200.gif");
  }

  @Test
  public void testGetTrendingDataWithLimitWithCustomApiKeyFromApiShouldParseCorrectly() {
    // Response
    final String mockResponse = "{\"data\":[{\"type\":\"gif\",\"id\":\"l3UcoeKGT777ML2ta\",\"slug\":\"hallmarkecards-dad-father-fathers-day-l3UcoeKGT777ML2ta\",\"url\":\"http:\\/\\/giphy.com\\/gifs\\/hallmarkecards-dad-father-fathers-day-l3UcoeKGT777ML2ta\",\"bitly_gif_url\":\"http:\\/\\/gph.is\\/1sTtL89\",\"bitly_url\":\"http:\\/\\/gph.is\\/1sTtL89\",\"embed_url\":\"http:\\/\\/giphy.com\\/embed\\/l3UcoeKGT777ML2ta\",\"username\":\"hallmarkecards\",\"source\":\"https:\\/\\/www.hallmarkecards.com\\/\",\"rating\":\"g\",\"content_url\":\"https:\\/\\/www.hallmarkecards.com\\/ecards\\/fathers-day-breakfast-npz5307\",\"user\":{\"avatar_url\":\"https:\\/\\/media4.giphy.com\\/avatars\\/hallmarkecards\\/W8ln0QjAtfUQ.gif\",\"banner_url\":\"https:\\/\\/media4.giphy.com\\/headers\\/hallmarkecards\\/9v2ae0uZWnAb.gif\",\"profile_url\":\"https:\\/\\/giphy.com\\/hallmarkecards\\/\",\"username\":\"hallmarkecards\",\"display_name\":\"Hallmark eCards\",\"twitter\":\"@hallmarkecards\"},\"source_tld\":\"www.hallmarkecards.com\",\"source_post_url\":\"https:\\/\\/www.hallmarkecards.com\\/\",\"is_indexable\":0,\"import_datetime\":\"2016-06-03 19:57:00\",\"trending_datetime\":\"2016-06-18 21:15:03\",\"images\":{\"fixed_height\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"377771\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.mp4\",\"mp4_size\":\"21433\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200.webp\",\"webp_size\":\"809928\"},\"fixed_height_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_s.gif\",\"width\":\"356\",\"height\":\"200\"},\"fixed_height_downsampled\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_d.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"127278\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200_d.webp\",\"webp_size\":\"126718\"},\"fixed_width\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.gif\",\"width\":\"200\",\"height\":\"113\",\"size\":\"119064\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.mp4\",\"mp4_size\":\"9841\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w.webp\",\"webp_size\":\"337074\"},\"fixed_width_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_s.gif\",\"width\":\"200\",\"height\":\"113\"},\"fixed_width_downsampled\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_d.gif\",\"width\":\"200\",\"height\":\"113\",\"size\":\"40521\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/200w_d.webp\",\"webp_size\":\"51568\"},\"fixed_height_small\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.gif\",\"width\":\"178\",\"height\":\"100\",\"size\":\"104302\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.mp4\",\"mp4_size\":\"8500\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100.webp\",\"webp_size\":\"291444\"},\"fixed_height_small_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100_s.gif\",\"width\":\"178\",\"height\":\"100\"},\"fixed_width_small\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.gif\",\"width\":\"100\",\"height\":\"56\",\"size\":\"34404\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.mp4\",\"mp4_size\":\"4728\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w.webp\",\"webp_size\":\"115922\"},\"fixed_width_small_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/100w_s.gif\",\"width\":\"100\",\"height\":\"56\"},\"downsized\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"downsized_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy_s.gif\",\"width\":\"640\",\"height\":\"360\"},\"downsized_large\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"downsized_medium\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\"},\"original\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.gif\",\"width\":\"640\",\"height\":\"360\",\"size\":\"1125239\",\"frames\":\"72\",\"mp4\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.mp4\",\"mp4_size\":\"37888\",\"webp\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy.webp\",\"webp_size\":\"2100910\"},\"original_still\":{\"url\":\"http:\\/\\/media3.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy_s.gif\",\"width\":\"640\",\"height\":\"360\"},\"looping\":{\"mp4\":\"http:\\/\\/media.giphy.com\\/media\\/l3UcoeKGT777ML2ta\\/giphy-loop.mp4\"}}}]}";

    server.enqueue(new MockResponse()
      .setResponseCode(HttpURLConnection.HTTP_OK)
      .setBody(mockResponse));

    // Request
    final GiphyResponse response = GiphyService.getInstance(mockEndPoint)
                                               .getTrendingResults(GiphyService.DEFAULT_RESULTS_COUNT, GiphyService.PUBLIC_API_KEY)
                                               .blockingFirst();

    assertThat(response.getData().get(0).getImages().getFixedHeight().getUrl())
      .isEqualTo("http://media3.giphy.com/media/l3UcoeKGT777ML2ta/200.gif");
  }

  // --------------------------------------------
  // getSearchResults
  // --------------------------------------------

  @Test public void testGetSearchDataFromApiShouldParseCorrectly() {
    // Response
    final String mockResponse = "{\"data\":[{\"type\":\"gif\",\"id\":\"gMkzyqQLydZ4Y\",\"slug\":\"cat-wtf-funny-gMkzyqQLydZ4Y\",\"url\":\"http:\\/\\/giphy.com\\/gifs\\/cat-wtf-funny-gMkzyqQLydZ4Y\",\"bitly_gif_url\":\"http:\\/\\/gph.is\\/1UTLQta\",\"bitly_url\":\"http:\\/\\/gph.is\\/1UTLQta\",\"embed_url\":\"http:\\/\\/giphy.com\\/embed\\/gMkzyqQLydZ4Y\",\"username\":\"\",\"source\":\"http:\\/\\/wifflegif.com\",\"rating\":\"g\",\"content_url\":\"\",\"source_tld\":\"wifflegif.com\",\"source_post_url\":\"http:\\/\\/wifflegif.com\",\"import_datetime\":\"2016-06-15 08:52:14\",\"trending_datetime\":\"1970-01-01 00:00:00\",\"images\":{\"fixed_height\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"508947\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.mp4\",\"mp4_size\":\"30769\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.webp\",\"webp_size\":\"238206\"},\"fixed_height_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_s.gif\",\"width\":\"356\",\"height\":\"200\"},\"fixed_height_downsampled\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_d.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"175502\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_d.webp\",\"webp_size\":\"79450\"},\"fixed_width\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.gif\",\"width\":\"200\",\"height\":\"112\",\"size\":\"172497\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.mp4\",\"mp4_size\":\"11776\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.webp\",\"webp_size\":\"90160\"},\"fixed_width_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_s.gif\",\"width\":\"200\",\"height\":\"112\"},\"fixed_width_downsampled\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_d.gif\",\"width\":\"200\",\"height\":\"112\",\"size\":\"61261\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_d.webp\",\"webp_size\":\"30372\"},\"fixed_height_small\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.gif\",\"width\":\"178\",\"height\":\"100\",\"size\":\"139542\",\"mp4\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.mp4\",\"mp4_size\":\"10822\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.webp\",\"webp_size\":\"80328\"},\"fixed_height_small_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100_s.gif\",\"width\":\"178\",\"height\":\"100\"},\"fixed_width_small\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.gif\",\"width\":\"100\",\"height\":\"56\",\"size\":\"46813\",\"mp4\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.mp4\",\"mp4_size\":\"5127\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.webp\",\"webp_size\":\"32714\"},\"fixed_width_small_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w_s.gif\",\"width\":\"100\",\"height\":\"56\"},\"downsized\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"downsized_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy_s.gif\",\"width\":\"500\",\"height\":\"281\"},\"downsized_large\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"downsized_medium\":{\"url\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"original\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\",\"frames\":\"18\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.mp4\",\"mp4_size\":\"77475\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.webp\",\"webp_size\":\"477842\"},\"original_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy_s.gif\",\"width\":\"500\",\"height\":\"281\"},\"looping\":{\"mp4\":\"https:\\/\\/media.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy-loop.mp4\"}}}]}";

    server.enqueue(new MockResponse()
      .setResponseCode(HttpURLConnection.HTTP_OK)
      .setBody(mockResponse));

    // Request
    final GiphyResponse response = GiphyService.getInstance(mockEndPoint)
                                               .getSearchResults("funny cat")
                                               .blockingFirst();

    assertThat(response.getData().get(0).getImages().getFixedHeight().getUrl())
      .isEqualTo("https://media4.giphy.com/media/gMkzyqQLydZ4Y/200.gif");
  }

  @Test public void testGetSearchDataCustomApiKeyFromApiShouldParseCorrectly() {
    // Response
    final String mockResponse = "{\"data\":[{\"type\":\"gif\",\"id\":\"gMkzyqQLydZ4Y\",\"slug\":\"cat-wtf-funny-gMkzyqQLydZ4Y\",\"url\":\"http:\\/\\/giphy.com\\/gifs\\/cat-wtf-funny-gMkzyqQLydZ4Y\",\"bitly_gif_url\":\"http:\\/\\/gph.is\\/1UTLQta\",\"bitly_url\":\"http:\\/\\/gph.is\\/1UTLQta\",\"embed_url\":\"http:\\/\\/giphy.com\\/embed\\/gMkzyqQLydZ4Y\",\"username\":\"\",\"source\":\"http:\\/\\/wifflegif.com\",\"rating\":\"g\",\"content_url\":\"\",\"source_tld\":\"wifflegif.com\",\"source_post_url\":\"http:\\/\\/wifflegif.com\",\"import_datetime\":\"2016-06-15 08:52:14\",\"trending_datetime\":\"1970-01-01 00:00:00\",\"images\":{\"fixed_height\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"508947\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.mp4\",\"mp4_size\":\"30769\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.webp\",\"webp_size\":\"238206\"},\"fixed_height_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_s.gif\",\"width\":\"356\",\"height\":\"200\"},\"fixed_height_downsampled\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_d.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"175502\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_d.webp\",\"webp_size\":\"79450\"},\"fixed_width\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.gif\",\"width\":\"200\",\"height\":\"112\",\"size\":\"172497\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.mp4\",\"mp4_size\":\"11776\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.webp\",\"webp_size\":\"90160\"},\"fixed_width_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_s.gif\",\"width\":\"200\",\"height\":\"112\"},\"fixed_width_downsampled\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_d.gif\",\"width\":\"200\",\"height\":\"112\",\"size\":\"61261\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_d.webp\",\"webp_size\":\"30372\"},\"fixed_height_small\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.gif\",\"width\":\"178\",\"height\":\"100\",\"size\":\"139542\",\"mp4\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.mp4\",\"mp4_size\":\"10822\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.webp\",\"webp_size\":\"80328\"},\"fixed_height_small_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100_s.gif\",\"width\":\"178\",\"height\":\"100\"},\"fixed_width_small\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.gif\",\"width\":\"100\",\"height\":\"56\",\"size\":\"46813\",\"mp4\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.mp4\",\"mp4_size\":\"5127\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.webp\",\"webp_size\":\"32714\"},\"fixed_width_small_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w_s.gif\",\"width\":\"100\",\"height\":\"56\"},\"downsized\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"downsized_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy_s.gif\",\"width\":\"500\",\"height\":\"281\"},\"downsized_large\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"downsized_medium\":{\"url\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"original\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\",\"frames\":\"18\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.mp4\",\"mp4_size\":\"77475\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.webp\",\"webp_size\":\"477842\"},\"original_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy_s.gif\",\"width\":\"500\",\"height\":\"281\"},\"looping\":{\"mp4\":\"https:\\/\\/media.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy-loop.mp4\"}}}]}";

    server.enqueue(new MockResponse()
      .setResponseCode(HttpURLConnection.HTTP_OK)
      .setBody(mockResponse));

    // Request
    final GiphyResponse response = GiphyService.getInstance(mockEndPoint)
                                               .getSearchResults("funny cat", GiphyService.PUBLIC_API_KEY)
                                               .blockingFirst();

    assertThat(response.getData().get(0).getImages().getFixedHeight().getUrl())
      .isEqualTo("https://media4.giphy.com/media/gMkzyqQLydZ4Y/200.gif");
  }

  @Test public void testGetSearchDataWithLimitCustomApiKeyFromApiShouldParseCorrectly() {
    // Response
    final String mockResponse = "{\"data\":[{\"type\":\"gif\",\"id\":\"gMkzyqQLydZ4Y\",\"slug\":\"cat-wtf-funny-gMkzyqQLydZ4Y\",\"url\":\"http:\\/\\/giphy.com\\/gifs\\/cat-wtf-funny-gMkzyqQLydZ4Y\",\"bitly_gif_url\":\"http:\\/\\/gph.is\\/1UTLQta\",\"bitly_url\":\"http:\\/\\/gph.is\\/1UTLQta\",\"embed_url\":\"http:\\/\\/giphy.com\\/embed\\/gMkzyqQLydZ4Y\",\"username\":\"\",\"source\":\"http:\\/\\/wifflegif.com\",\"rating\":\"g\",\"content_url\":\"\",\"source_tld\":\"wifflegif.com\",\"source_post_url\":\"http:\\/\\/wifflegif.com\",\"import_datetime\":\"2016-06-15 08:52:14\",\"trending_datetime\":\"1970-01-01 00:00:00\",\"images\":{\"fixed_height\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"508947\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.mp4\",\"mp4_size\":\"30769\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200.webp\",\"webp_size\":\"238206\"},\"fixed_height_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_s.gif\",\"width\":\"356\",\"height\":\"200\"},\"fixed_height_downsampled\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_d.gif\",\"width\":\"356\",\"height\":\"200\",\"size\":\"175502\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200_d.webp\",\"webp_size\":\"79450\"},\"fixed_width\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.gif\",\"width\":\"200\",\"height\":\"112\",\"size\":\"172497\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.mp4\",\"mp4_size\":\"11776\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w.webp\",\"webp_size\":\"90160\"},\"fixed_width_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_s.gif\",\"width\":\"200\",\"height\":\"112\"},\"fixed_width_downsampled\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_d.gif\",\"width\":\"200\",\"height\":\"112\",\"size\":\"61261\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/200w_d.webp\",\"webp_size\":\"30372\"},\"fixed_height_small\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.gif\",\"width\":\"178\",\"height\":\"100\",\"size\":\"139542\",\"mp4\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.mp4\",\"mp4_size\":\"10822\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100.webp\",\"webp_size\":\"80328\"},\"fixed_height_small_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100_s.gif\",\"width\":\"178\",\"height\":\"100\"},\"fixed_width_small\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.gif\",\"width\":\"100\",\"height\":\"56\",\"size\":\"46813\",\"mp4\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.mp4\",\"mp4_size\":\"5127\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w.webp\",\"webp_size\":\"32714\"},\"fixed_width_small_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/100w_s.gif\",\"width\":\"100\",\"height\":\"56\"},\"downsized\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"downsized_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy_s.gif\",\"width\":\"500\",\"height\":\"281\"},\"downsized_large\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"downsized_medium\":{\"url\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\"},\"original\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.gif\",\"width\":\"500\",\"height\":\"281\",\"size\":\"1035715\",\"frames\":\"18\",\"mp4\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.mp4\",\"mp4_size\":\"77475\",\"webp\":\"http:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy.webp\",\"webp_size\":\"477842\"},\"original_still\":{\"url\":\"https:\\/\\/media4.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy_s.gif\",\"width\":\"500\",\"height\":\"281\"},\"looping\":{\"mp4\":\"https:\\/\\/media.giphy.com\\/media\\/gMkzyqQLydZ4Y\\/giphy-loop.mp4\"}}}]}";

    server.enqueue(new MockResponse()
      .setResponseCode(HttpURLConnection.HTTP_OK)
      .setBody(mockResponse));

    // Request
    final GiphyResponse response = GiphyService.getInstance(mockEndPoint)
                                               .getSearchResults("funny cat", GiphyService.DEFAULT_RESULTS_COUNT, GiphyService.PUBLIC_API_KEY)
                                               .blockingFirst();

    assertThat(response.getData().get(0).getImages().getFixedHeight().getUrl())
      .isEqualTo("https://media4.giphy.com/media/gMkzyqQLydZ4Y/200.gif");
  }
}
